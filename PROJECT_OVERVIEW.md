# 政采云智能助手 - 项目逻辑与架构梳理

> 本文档旨在梳理项目的核心业务逻辑、技术架构及当前功能实现状态，帮助明确后续开发方向。

---

## 1. 核心业务逻辑

本系统的核心目标是**“合规搬运”**：帮助用户将外部平台（京东、天猫、苏宁）或政采云其他店铺的优质商品，高效、合规地上传到自己的政采云店铺。

### 业务流程图

```mermaid
graph TD
    A[用户需求: 寻找商品] --> B{来源选择}
    
    B -->|外部平台| C[京东/天猫/苏宁]
    B -->|内部平台| D[政采云其他店铺]
    
    C --> E[数据采集 (Crawler)]
    D --> E
    
    E --> F[数据清洗与合规化 (Backend + AI)]
    F --> G[生成商品草稿 (Draft)]
    
    G --> H{风险检测 (AI)}
    H -->|低风险| I[直接上传]
    H -->|高风险| J[木马策略 (Trojan Strategy)]
    
    I --> K[政采云店铺]
    J --> L[上传安全替代品]
    L --> M[监控审核状态]
    M -->|审核通过| N[替换为真实商品]
    N --> K
```

---

## 2. 核心功能模块详解

### 2.1 商品搬运系统 (Product Replication)
这是“搬运”的基础设施，负责从源网站获取数据并转换为政采云支持的格式。

*   **已实现**:
    *   **京东爬虫 (`crawler.ts`)**: 支持关键词搜索和商品图片提取。
    *   **图片代理 (`image-proxy`)**: 解决京东/天猫图片的防盗链问题，确保图片能顺利上传到政采云。
    *   **数据存储 (`ProductDraft`)**: 数据库已设计好存储商品标题、价格、库存、详情 HTML、SKU 等完整信息的结构。
*   **待完善**:
    *   **苏宁易购爬虫**: 目前代码中暂未发现针对苏宁的特定爬虫逻辑。
    *   **政采云站内复制**: 目前 `zcy-extractor.ts` 主要用于提取当前登录用户的公司信息，尚未包含完整的政采云商品详情页抓取逻辑。

### 2.2 智能合规引擎 (Compliance Engine)
这是项目的核心竞争力，解决“必须要符合政采云规定”的痛点。

*   **AI 类目分析**:
    *   通过 AI 分析商品名称和描述，自动匹配政采云的正确类目，避免因类目错放导致的违规。
*   **风险检测与木马策略**:
    *   **风险识别**: 系统会自动检测商品是否属于敏感类别（如特定高性能设备、涉密产品等）。
    *   **安全马甲**: 对于高风险商品，AI 会生成一个“安全马甲名称”（如将“高性能游戏显卡”包装为“计算机图形处理组件”）。
    *   **自动替换**: 先上传“马甲”商品，通过审核后，自动化脚本 (`trojan-worker.tsx`) 会自动将商品信息替换回真实内容。

### 2.3 自动化上传 (Auto Publisher)
这是“最后一步”，将处理好的数据自动填入政采云后台。

*   **智能填表 (`publisher.tsx`, `zcy-dom.ts`)**:
    *   自动填写商品标题、价格、库存。
    *   自动上传图片（支持拖拽模拟）。
    *   自动处理富文本详情描述。
*   **状态机 (`trojan-worker.tsx`)**:
    *   能够在页面跳转（发布页 -> 列表页 -> 详情页 -> 编辑页）之间保持任务状态，实现全自动化的复杂操作流程。

---

## 3. 技术架构与现状

| 模块 | 技术栈 | 当前状态 | 说明 |
| :--- | :--- | :--- | :--- |
| **前端插件** | Plasmo (React + TS) | ✅ 成熟 | UI、注入脚本、DOM 操作逻辑已完善。 |
| **后端服务** | Next.js + Prisma | ✅ 成熟 | API 接口、数据库、支付回调均已打通。 |
| **AI 服务** | OpenAI / Claude | ✅ 成熟 | 支持文本分析和视觉识别，已集成 Prompt 优化。 |
| **爬虫引擎** | Puppeteer | ⚠️ 部分完成 | 京东爬虫可用（含 Bing 备选），**苏宁/政采云站内爬虫待开发**。 |
| **支付系统** | 微信/支付宝 | ✅ 完成 | 支持 Mock 和真实支付流程（需配置 Key）。 |

---

## 4. 后续建议 (Next Steps)

为了完全实现您描述的愿景，建议接下来的开发重点放在：

1.  **补全爬虫源**: 开发针对 **苏宁易购** 和 **政采云商品详情页** 的专用抓取脚本。
2.  **完善“一键复制”体验**: 在插件 Popup 中增加“复制当前页面商品”按钮，当用户浏览京东/苏宁/政采云商品时，点击即可自动提取并存入草稿箱。
3.  **批量操作**: 允许用户输入多个链接，后台批量抓取并生成草稿。

---

**文档版本**: v1.1
**生成时间**: 2025-11-25