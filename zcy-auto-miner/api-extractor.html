<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>æ”¿é‡‡äº‘26å¤§ç±»APIæå–å™¨</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #0f0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
        }

        button {
            background: #e11d48;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 0;
        }

        button:hover {
            background: #be123c;
        }

        #log {
            height: 400px;
            overflow-y: auto;
            background: #111;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 12px;
        }

        .success {
            color: #0f0;
        }

        .error {
            color: #f00;
        }

        .info {
            color: #ff0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ¯ æ”¿é‡‡äº‘26å¤§ç±»APIæå–å™¨</h1>
        <p>è¯·å…ˆæ‰“å¼€æ”¿é‡‡äº‘é¡µé¢ï¼Œç„¶ååœ¨è¯¥é¡µé¢çš„æ§åˆ¶å°ç²˜è´´å¹¶è¿è¡Œæ­¤è„šæœ¬</p>

        <h3>ğŸ“‹ ä½¿ç”¨æ–¹æ³•ï¼š</h3>
        <ol>
            <li>ç™»å½•æ”¿é‡‡äº‘å–å®¶åå°</li>
            <li>æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·</li>
            <li>åˆ‡æ¢åˆ° Consoleï¼ˆæ§åˆ¶å°ï¼‰æ ‡ç­¾</li>
            <li>å¤åˆ¶ä¸‹é¢çš„ä»£ç å¹¶ç²˜è´´åˆ°æ§åˆ¶å°</li>
            <li>æŒ‰ Enter æ‰§è¡Œ</li>
        </ol>

        <h3>ğŸ“ å¤åˆ¶è¿™æ®µä»£ç åˆ°æ”¿é‡‡äº‘é¡µé¢çš„æ§åˆ¶å°ï¼š</h3>
        <textarea id="code" readonly
            style="width: 100%; height: 600px; background: #111; color: #0f0; padding: 10px; font-family: monospace; border-radius: 5px;">
(async function() {
    console.log('ğŸš€ å¼€å§‹æå–æ”¿é‡‡äº‘26å¤§ç±»ç›®...');
    
    const targetCategories = [
        "æœºç”µè®¾å¤‡", "æ•™å­¦ç§‘ç ”ï¼ˆå«ç‰¹è®¸ç»è¥ç±»ç›®ï¼‰", "å®‰å…¨é˜²æŠ¤", 
        "æ©¡èƒ¶åŠå¡‘æ–™åˆ¶å“", "å›¾ä¹¦æ¡£æ¡ˆè®¾å¤‡", "å›¾ä¹¦å’Œæ¡£æ¡ˆï¼ˆå«ç‰¹è®¸ç»è¥ç±»ç›®ï¼‰",
        "ä»ªå™¨ä»ªè¡¨", "ä¸“ç”¨è®¾å¤‡", "3Cæ•°ç ", "åŠå…¬è®¾å¤‡/è€—æ",
        "æ–‡åŒ–ç”¨å“", "å®¶å±…å»ºæ", "å®¶ç”¨ç”µå™¨", "æ—¥ç”¨ç™¾è´§",
        "é£Ÿå“é…’æ°´ï¼ˆå«ç‰¹è®¸ç»è¥ç±»ç›®ï¼‰", "åŠ³åŠ¨ä¿æŠ¤ç”¨å“", "è¿åŠ¨æˆ·å¤–",
        "äº”é‡‘/å·¥å…·", "æ–‡åŒ–ç©ä¹", "æ•™è‚²è£…å¤‡", "é²œèŠ±ç»¿æ¤",
        "ä¿¡æ¯æŠ€æœ¯", "ä½“è‚²ç”¨å“åŠå™¨æ", "ä½“è‚²ç›¸å…³ç”¨å“å’Œè®¾å¤‡",
        "ç§‘ç ”ä»ªå™¨", "é˜²æŠ¤ç”¨å“"
    ];

    const allData = {};
    let totalCount = 0;

    // æ–¹æ¡ˆAï¼šå°è¯•ä»é¡µé¢ä¸­æŸ¥æ‰¾APIæ¥å£
    const findCategoryAPI = () => {
        // ç›‘å¬æ‰€æœ‰ç½‘ç»œè¯·æ±‚
        const originalFetch = window.fetch;
        const apis = [];
        
        window.fetch = async function(...args) {
            const url = args[0];
            if (typeof url === 'string' && (url.includes('category') || url.includes('cate'))) {
                apis.push(url);
                console.log('ğŸ“¡ å‘ç°ç±»ç›®API:', url);
            }
            return originalFetch.apply(this, args);
        };
        
        setTimeout(() => {
            window.fetch = originalFetch;
            console.log('âœ… æ‰¾åˆ°çš„API:', apis);
        }, 5000);
    };

    // æ–¹æ¡ˆBï¼šé€šè¿‡ç‚¹å‡»è§¦å‘åŠ è½½
    const clickAllCategories = async () => {
        const items = document.querySelectorAll('.doraemon-list-item, [class*="category"], [class*="menu-item"]');
        console.log(`ğŸ¯ æ‰¾åˆ° ${items.length} ä¸ªèœå•é¡¹`);
        
        for (let i = 0; i < items.length; i++) {
            const item = items[i];
            const text = item.innerText?.split('\n')[0] || '';
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯26å¤§ç±»ä¹‹ä¸€
            if (targetCategories.some(cat => text.includes(cat) || cat.includes(text))) {
                console.log(`ğŸ‘† [${i+1}/${items.length}] ç‚¹å‡»: ${text}`);
                item.click();
                item.scrollIntoView({block: "center"});
                
                // ç­‰å¾…æ•°æ®åŠ è½½
                await new Promise(r => setTimeout(r, 2000));
            }
        }
    };

    // æ–¹æ¡ˆCï¼šç›´æ¥ä»é¡µé¢DOMæå–
    const extractFromDOM = () => {
        // å°è¯•å¤šç§é€‰æ‹©å™¨
        const selectors = [
            '.category-item',
            '.menu-item',
            '[data-category]',
            '.category-list li',
            '.doraemon-list-item'
        ];

        for (const selector of selectors) {
            const elements = document.querySelectorAll(selector);
            if (elements.length > 0) {
                console.log(`âœ… ä½¿ç”¨é€‰æ‹©å™¨: ${selector}ï¼Œæ‰¾åˆ° ${elements.length} ä¸ªå…ƒç´ `);
                
                elements.forEach(el => {
                    const name = el.innerText?.trim();
                    const id = el.getAttribute('data-id') || el.getAttribute('data-key');
                    
                    if (name && targetCategories.some(cat => name.includes(cat) || cat.includes(name))) {
                        allData[name] = {
                            name: name,
                            id: id || 'unknown',
                            source: 'DOM'
                        };
                        totalCount++;
                        console.log(`ğŸ“¦ æå–: ${name}`);
                    }
                });
                
                if (totalCount > 0) break;
            }
        }
    };

    // æ–¹æ¡ˆDï¼šæ‹¦æˆªXHRè¯·æ±‚
    const interceptXHR = () => {
        const XHR = XMLHttpRequest.prototype;
        const originalSend = XHR.send;
        
        XHR.send = function() {
            this.addEventListener('load', function() {
                try {
                    const data = JSON.parse(this.responseText);
                    const list = data.result || data.data || data.list || [];
                    
                    if (Array.isArray(list)) {
                        list.forEach(item => {
                            if (item && item.name && targetCategories.some(cat => 
                                item.name.includes(cat) || cat.includes(item.name))) {
                                
                                if (!allData[item.id]) {
                                    allData[item.id] = {
                                        id: item.id,
                                        name: item.name,
                                        pid: item.parentId || item.pid || 0,
                                        code: item.code || item.categoryCode || ''
                                    };
                                    totalCount++;
                                    console.log(`ğŸ“¡ æ‹¦æˆªåˆ°: ${item.name} (ID:${item.id})`);
                                }
                            }
                        });
                    }
                } catch (e) {}
            });
            return originalSend.apply(this, arguments);
        };
    };

    // æ‰§è¡Œæå–
    console.log('ğŸ” å¯åŠ¨æ‹¦æˆªå™¨...');
    interceptXHR();
    
    console.log('ğŸ“¡ ç›‘å¬API...');
    findCategoryAPI();
    
    console.log('ğŸ–±ï¸ å¼€å§‹ç‚¹å‡»...');
    await clickAllCategories();
    
    console.log('ğŸ“„ å°è¯•DOMæå–...');
    extractFromDOM();
    
    // ç­‰å¾…æ•°æ®æ”¶é›†
    await new Promise(r => setTimeout(r, 3000));
    
    // å¯¼å‡ºç»“æœ
    console.log(`âœ… æå–å®Œæˆï¼å…±æ”¶é›† ${totalCount} æ¡æ•°æ®`);
    console.log('ğŸ“Š æ•°æ®é¢„è§ˆ:', allData);
    
    // ç”ŸæˆTXT
    let content = "ID\tç±»ç›®åç§°\tçˆ¶çº§ID\tç±»ç›®ç¼–ç \n";
    content += "=".repeat(80) + "\n";
    Object.values(allData).forEach(row => {
        content += `${row.id}\t${row.name}\t${row.pid || 'N/A'}\t${row.code || 'N/A'}\n`;
    });
    
    // ä¸‹è½½
    const blob = new Blob([content], {type: "text/plain;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `æ”¿é‡‡äº‘26å¤§ç±»_${totalCount}æ¡_${Date.now()}.txt`;
    a.click();
    
    console.log('ğŸ’¾ å·²è‡ªåŠ¨ä¸‹è½½ TXT æ–‡ä»¶ï¼');
    
    // åŒæ—¶è¾“å‡ºJSON
    console.log('ğŸ“‹ JSONæ ¼å¼æ•°æ®ï¼š');
    console.log(JSON.stringify(Object.values(allData), null, 2));
    
})();
        </textarea>

        <button onclick="copyCode()">ğŸ“‹ å¤åˆ¶ä»£ç </button>
    </div>

    <script>
        function copyCode() {
            const code = document.getElementById('code');
            code.select();
            document.execCommand('copy');
            alert('âœ… ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nè¯·åˆ°æ”¿é‡‡äº‘é¡µé¢çš„æ§åˆ¶å°ç²˜è´´å¹¶è¿è¡Œã€‚');
        }
    </script>
</body>

</html>