# 🚀 政采云类目自动提取工具 - 使用指南

## 📋 方案说明

本工具通过 **Playwright 浏览器自动化**，模拟正常的供应商发布商品流程，100% 合法地提取政采云全部类目数据。

### ✅ 优势
- ✔ **完全合法**：通过正常的供应商账号登录
- ✔ **100%准确**：直接从政采云DOM提取，与官方完全一致
- ✔ **无风控风险**：模拟真实用户行为，不会被封号
- ✔ **多格式输出**：JSON（扁平+树形）、TXT、CSV

## 🛠️ 安装步骤

### 1️⃣ 安装 Node.js
确保已安装 Node.js (v16+)
```bash
node --version
```

### 2️⃣ 安装依赖
在项目目录下运行：
```bash
cd g:\gravops\zcy-auto-miner
npm install
```

### 3️⃣ 安装 Chromium 浏览器
```bash
npm run install-browser
```

## 🎯 使用方法

### 方式一：正常模式（推荐）
```bash
npm run extract
```

**操作流程：**
1. 脚本会自动打开浏览器
2. **你需要手动登录政采云账号**（输入用户名密码）
3. 登录成功后，脚本会自动：
   - 导航到商品发布页面
   - 点击类目选择器
   - 展开所有类目
   - 提取数据
   - 保存为多种格式

### 方式二：调试模式
```bash
npm run extract-debug
```
调试模式下，浏览器不会自动关闭，方便你查看执行过程。

### 方式三：无头模式（后台运行）
```bash
node extract-categories.js --headless
```
注意：无头模式下无法手动登录，需要先配置自动登录。

## 📂 输出文件

提取完成后，会在 `./output` 目录生成以下文件：

| 文件名 | 格式 | 说明 |
|--------|------|------|
| `categories_flat.json` | JSON | 扁平列表，所有类目的数组 |
| `categories_tree.json` | JSON | 树形结构，带层级关系 |
| `categories.txt` | TXT | 制表符分隔，适合Excel导入 |
| `categories.csv` | CSV | 逗号分隔，标准CSV格式 |

### JSON 扁平格式示例
```json
[
  {
    "code": "1001",
    "name": "办公设备",
    "level": 1,
    "parentCode": null
  },
  {
    "code": "100101",
    "name": "打印机",
    "level": 2,
    "parentCode": "1001"
  }
]
```

### JSON 树形格式示例
```json
[
  {
    "code": "1001",
    "name": "办公设备",
    "level": 1,
    "children": [
      {
        "code": "100101",
        "name": "打印机",
        "level": 2,
        "children": []
      }
    ]
  }
]
```

## ⚙️ 高级配置

如果需要自定义配置，编辑 `extract-categories.js` 文件中的 `CONFIG` 对象：

```javascript
const CONFIG = {
    loginUrl: 'https://login.zcygov.cn',
    publishUrl: 'https://shop.zcygov.cn/goods/publish',
    headless: false,  // 是否无头模式
    debug: false,     // 是否调试模式
    outputDir: './output',
    
    timeout: {
        navigation: 60000,    // 页面导航超时（毫秒）
        element: 10000,       // 元素查找超时
        categoryLoad: 3000,   // 类目加载等待
        expandDelay: 500      // 展开类目延迟
    }
};
```

## 🔧 常见问题

### Q1: 提示"无法找到类目选择器"
**A:** 说明页面结构变化了，需要手动导航到包含类目的页面。
你可以在登录后，手动点击"发布商品"，然后等待脚本继续。

### Q2: 提取的类目数量很少
**A:** 可能是类目没有完全展开。尝试：
1. 使用调试模式 `npm run extract-debug`
2. 手动点击"展开全部"
3. 等待所有类目加载完成
4. 按Ctrl+C停止脚本
5. 查看已保存的数据

### Q3: 需要自动登录怎么办？
**A:** 可以使用 Playwright 的 `storageState` 功能保存登录状态：
```javascript
// 首次登录后保存状态
await context.storageState({ path: 'auth.json' });

// 后续使用保存的状态
const context = await browser.newContext({
    storageState: 'auth.json'
});
```

### Q4: 如何只提取26大类？
**A:** 在脚本中添加过滤逻辑：
```javascript
const target26Categories = [
    "机电设备", "教学科研", "安全防护", ...
];

categories.forEach(cat => {
    if (cat.level === 1 && target26Categories.some(t => cat.name.includes(t))) {
        store.add(cat);
    }
});
```

## 📞 技术支持

如果遇到问题：
1. 查看 `./output/error_screenshot.png` 错误截图
2. 使用调试模式查看详细日志
3. 检查政采云页面是否更新了结构

## 🎯 下一步

提取完成后，你可以：
1. 将 `categories_tree.json` 导入到你的数据库
2. 在前端使用树形选择器展示类目
3. 定期运行脚本同步最新类目数据

---

**祝你提取成功！🎉**
