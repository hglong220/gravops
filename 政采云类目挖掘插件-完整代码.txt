=====================================================
æ”¿é‡‡äº‘å…¨è‡ªåŠ¨ç±»ç›®æŒ–æ˜æœº - Chromeæ‰©å±•å®Œæ•´ä»£ç 
ä½¿ç”¨è¯´æ˜ï¼šå¤åˆ¶ä¸‹é¢3ä¸ªæ–‡ä»¶çš„ä»£ç ï¼Œåˆ†åˆ«ä¿å­˜ä¸ºå¯¹åº”æ–‡ä»¶å
=====================================================

ã€å®‰è£…æ­¥éª¤ã€‘
1. åˆ›å»ºæ–‡ä»¶å¤¹ï¼šzcy-miner
2. åœ¨æ–‡ä»¶å¤¹ä¸­åˆ›å»º3ä¸ªæ–‡ä»¶ï¼ˆå¤åˆ¶ä¸‹é¢å¯¹åº”çš„ä»£ç ï¼‰ï¼š
   - manifest.json
   - inject.js
   - content.js
3. Chromeæ‰“å¼€ chrome://extensions/
4. å¯ç”¨"å¼€å‘è€…æ¨¡å¼"
5. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"ï¼Œé€‰æ‹© zcy-miner æ–‡ä»¶å¤¹

ã€ä½¿ç”¨æ–¹æ³•ã€‘
1. ç™»å½•æ”¿é‡‡äº‘ï¼Œè¿›å…¥"å•†å“å‘å¸ƒ > ç±»ç›®é€‰æ‹©"é¡µé¢
2. å³ä¸‹è§’ä¼šå‡ºç°ç»¿è‰²é¢æ¿
3. ç‚¹å‡»"ğŸš€ å¼€å§‹è‡ªåŠ¨æŒ–æ˜"
4. ç­‰å¾…å®Œæˆåç‚¹"ğŸ’¾ å¯¼å‡ºJSON"

=====================================================
æ–‡ä»¶1: manifest.json
=====================================================

{
  "manifest_version": 3,
  "name": "æ”¿é‡‡äº‘å…¨è‡ªåŠ¨æŒ–æ˜æœº (120%è¦†ç›–ç‰ˆ)",
  "version": "2.0",
  "permissions": ["scripting", "activeTab"],
  "host_permissions": ["*://*.zcygov.cn/*"],
  "web_accessible_resources": [{
    "resources": ["inject.js"],
    "matches": ["*://*.zcygov.cn/*"]
  }],
  "content_scripts": [{
    "matches": ["*://*.zcygov.cn/*"],
    "js": ["content.js"],
    "run_at": "document_end"
  }]
}

=====================================================
æ–‡ä»¶2: inject.js
=====================================================

// inject.js - é©»ç•™åœ¨é¡µé¢å†…éƒ¨ï¼Œè´Ÿè´£æ‹¦æˆªæ•°æ®
(function() {
    console.log("ğŸ•µï¸â€â™€ï¸ ç›‘å¬æ¢é’ˆå·²å°±ä½...");
    const XHR = XMLHttpRequest.prototype;
    const open = XHR.open;
    const send = XHR.send;

    // æ‹¦æˆª Fetch (æ–°ç‰ˆæ¥å£)
    const originalFetch = window.fetch;
    window.fetch = async function(...args) {
        const response = await originalFetch(...args);
        const clone = response.clone();
        clone.json().then(data => broadcast(data)).catch(()=>{});
        return response;
    };

    // æ‹¦æˆª XHR (è€ç‰ˆæ¥å£)
    XHR.send = function(postData) {
        this.addEventListener('load', function() {
            try {
                const data = JSON.parse(this.responseText);
                broadcast(data);
            } catch (e) {}
        });
        return send.apply(this, arguments);
    };

    // å¹¿æ’­æ•°æ®ç»™ Content Script
    function broadcast(json) {
        if (!json) return;
        // è¿‡æ»¤ï¼šåªä¿ç•™ç±»ç›®ç›¸å…³çš„æ•°æ®
        const list = json.result || json.data || json.list || json;
        if (Array.isArray(list) && list.length > 0 && list[0].id && list[0].name) {
            window.postMessage({ type: 'ZCY_DATA_CAPTURED', payload: list }, '*');
        }
    }
})();

=====================================================
æ–‡ä»¶3: content.js
=====================================================

// content.js - è´Ÿè´£è‡ªåŠ¨ç‚¹å‡»å’Œæ”¶é›†
console.log("ğŸ¤– è‡ªåŠ¨æŒ–æ˜æœºå·²åŠ è½½");

// 1. æ³¨å…¥ç›‘å¬è„šæœ¬
const script = document.createElement('script');
script.src = chrome.runtime.getURL('inject.js');
(document.head || document.documentElement).appendChild(script);

// 2. å®šä¹‰æˆ‘ä»¬è¦æŒ–çš„ 120% ç›®æ ‡å…³é”®è¯
const TARGET_KEYWORDS = [
    "è®¡ç®—æœº", "åŠå…¬è®¾å¤‡", "3C", "æ•°ç ", "æ–‡åŒ–ç”¨å“",  // æ ¸å¿ƒ
    "å®¶å…·", "å»ºæ", "å®¶å±…",                         // è£…ä¿®
    "ç”µå™¨", "ç©ºè°ƒ", "å†°ç®±",                         // ç”µå™¨
    "ç™¾è´§", "æ—¥ç”¨", "æ¸…æ´",                         // è€—æ
    "åŠ³åŠ¨", "é˜²æŠ¤", "åŠ³ä¿",                         // èµ„è´¨
    "è¿åŠ¨", "ä½“è‚²",                                 // å­¦æ ¡
    "äº”é‡‘", "å·¥å…·", "ä»ªå™¨"                          // ç»´ä¿®
];

// å­˜å‚¨æˆ˜åˆ©å“
let collectedData = {};

// 3. ç›‘å¬æ•°æ®å›ä¼ 
window.addEventListener('message', (event) => {
    if (event.data.type === 'ZCY_DATA_CAPTURED') {
        const list = event.data.payload;
        list.forEach(item => {
            // ç®€å•å»é‡
            if (!collectedData[item.id]) {
                collectedData[item.id] = {
                    id: item.id,
                    name: item.name,
                    code: item.code,
                    pid: item.parentId || 0
                };
                updateUI(`âœ… æ•è·: ${item.name} (ID:${item.id})`);
            }
        });
    }
});

// 4. åˆ›å»ºæ“ä½œé¢æ¿ UI
function createUI() {
    const div = document.createElement('div');
    div.id = "zcy-panel";
    div.style.cssText = "position:fixed; bottom:50px; right:20px; width:300px; background:white; border:2px solid #10b981; z-index:99999; padding:15px; border-radius:10px; box-shadow:0 10px 20px rgba(0,0,0,0.2); font-family:sans-serif;";
    div.innerHTML = `
        <h3 style="margin:0 0 10px 0; border-bottom:1px solid #eee; padding-bottom:5px;">ğŸ¤– å…¨è‡ªåŠ¨æŒ–æ˜æœº</h3>
        <div id="status-text" style="color:#666; font-size:13px; margin-bottom:10px;">ç­‰å¾…æŒ‡ä»¤...</div>
        <button id="btn-run" style="width:100%; padding:10px; background:#10b981; color:white; border:none; border-radius:5px; cursor:pointer; font-weight:bold;">ğŸš€ å¼€å§‹è‡ªåŠ¨æŒ–æ˜</button>
        <button id="btn-export" style="width:100%; padding:10px; background:#3b82f6; color:white; border:none; border-radius:5px; cursor:pointer; font-weight:bold; margin-top:5px; display:none;">ğŸ’¾ å¯¼å‡º JSON</button>
    `;
    document.body.appendChild(div);

    document.getElementById('btn-run').onclick = startAutoClick;
    document.getElementById('btn-export').onclick = downloadData;
}

function updateUI(msg) {
    const el = document.getElementById('status-text');
    if (el) {
        el.innerText = msg;
    }
}

// 5. æ ¸å¿ƒé€»è¾‘ï¼šè‡ªåŠ¨å¯»æ‰¾å¹¶ç‚¹å‡»èœå•
async function startAutoClick() {
    const btn = document.getElementById('btn-run');
    btn.disabled = true;
    btn.style.background = "#ccc";
    btn.innerText = "æ­£åœ¨æŒ–æ˜ä¸­...";

    // è·å–å·¦ä¾§æ‰€æœ‰èœå•é¡¹
    const items = document.querySelectorAll('.doraemon-list-item'); // åŸºäºä½ ä¹‹å‰çš„æˆªå›¾ç±»å
    if(items.length === 0) {
        alert("âŒ æœªæ‰¾åˆ°å·¦ä¾§èœå•ï¼è¯·ç¡®ä¿ä½ åœ¨ã€å•†å“å‘å¸ƒã€‘é¡µé¢ï¼");
        return;
    }

    let clickCount = 0;

    for (let item of items) {
        const text = item.innerText || "";
        // æ£€æŸ¥æ˜¯å¦åŒ…å«æˆ‘ä»¬çš„å…³é”®è¯
        if (TARGET_KEYWORDS.some(key => text.includes(key))) {
            updateUI(`ğŸ‘† æ­£åœ¨ç‚¹å‡»: ${text.split('\n')[0]}...`);
            
            // æ¨¡æ‹Ÿç‚¹å‡»
            item.click();
            clickCount++;

            // ç­‰å¾… 1.5 ç§’è®©æ•°æ®åŠ è½½ï¼ˆä¸èƒ½å¤ªå¿«ï¼Œå¦åˆ™ä¼šè¢«å°æˆ–æ¼æŠ“ï¼‰
            await new Promise(r => setTimeout(r, 1500));
        }
    }

    updateUI(`ğŸ‰ å®Œæˆï¼å…±ç‚¹å‡» ${clickCount} ä¸ªå¤§ç±»ã€‚`);
    document.getElementById('btn-export').style.display = 'block';
    btn.innerText = "æŒ–æ˜å®Œæˆ";
}

// 6. å¯¼å‡ºæ–‡ä»¶
function downloadData() {
    const dataStr = JSON.stringify(Object.values(collectedData), null, 2);
    const blob = new Blob([dataStr], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "zcy_full_categories.json";
    a.click();
}

// å¯åŠ¨ UI
setTimeout(createUI, 2000);

=====================================================
é¢å¤–å·¥å…·: æŸ¥æ¼è¡¥ç¼ºè„šæœ¬ï¼ˆå¯é€‰ï¼‰
=====================================================
å¦‚æœéœ€è¦è¡¥å……æ›´å¤šç±»ç›®ï¼Œåœ¨æ”¿é‡‡äº‘é¡µé¢æŒ‰F12æ‰“å¼€æ§åˆ¶å°ï¼Œç²˜è´´ä¸‹é¢ä»£ç å¹¶å›è½¦ï¼š

(function() {
    console.clear();
    console.log("ğŸ•µï¸â€â™€ï¸ æŸ¥æ¼è¡¥ç¼ºæ¨¡å¼å¯åŠ¨ï¼ç›®æ ‡ï¼šè¦†ç›– 26 å¤§ç±»...");

    const MISSING_TARGETS = [
        "æœºç”µ", "æ•™å­¦", "ç§‘ç ”", "å®‰å…¨", "æ©¡èƒ¶", 
        "å›¾ä¹¦", "æ¡£æ¡ˆ", "ä»ªå™¨", "ä»ªè¡¨", "ä¸“ç”¨è®¾å¤‡", 
        "å»ºæ", "é£Ÿå“", "é…’æ°´", "é²œèŠ±", "ç»¿æ¤", 
        "æ•™è‚²", "ä½“è‚²", "é˜²æŠ¤"
    ];

    let newCollection = {};

    const originalFetch = window.fetch;
    window.fetch = async function(...args) {
        const response = await originalFetch(...args);
        const clone = response.clone();
        clone.json().then(data => {
            const list = data.result || data.data || data.list || data;
            if (Array.isArray(list)) {
                list.forEach(item => {
                    if (item.name && item.id) {
                        if (!newCollection[item.id]) {
                            newCollection[item.id] = { id: item.id, name: item.name, pid: item.parentId };
                            if (MISSING_TARGETS.some(t => item.name.includes(t))) {
                                console.log(`ğŸ”¥ è¡¥å…¨æˆåŠŸ: [${item.name}] ID: ${item.id}`);
                            }
                        }
                    }
                });
            }
        }).catch(()=>{});
        return response;
    };

    setTimeout(() => {
        const items = document.querySelectorAll('.doraemon-list-item');
        console.log(`ğŸ“‹ å·¦ä¾§èœå•å…±æ‰¾åˆ° ${items.length} é¡¹ã€‚æ­£åœ¨å¯»æ‰¾ç¼ºå¤±ç±»ç›®...`);
        
        items.forEach(item => {
            const text = item.innerText;
            if (MISSING_TARGETS.some(t => text.includes(t))) {
                console.log(`ğŸ‘‡ è¯·ç‚¹å‡»: ${text}`);
                item.click(); 
            }
        });
        
        console.log("âœ… è‡ªåŠ¨ç‚¹å‡»å·²è§¦å‘ï¼Œè¯·ç•™æ„æ§åˆ¶å°çš„ã€ğŸ”¥ è¡¥å…¨æˆåŠŸã€‘æ—¥å¿—ï¼");
        console.log("â³ ç­‰å¾… 10 ç§’åï¼Œè¾“å…¥ exportMissing() å¯¼å‡ºæ–°æ•°æ®ã€‚");
    }, 2000);

    window.exportMissing = function() {
        console.log(JSON.stringify(Object.values(newCollection), null, 2));
    };
})();

=====================================================
â˜¢ï¸ ç»ˆææ­¦å™¨ï¼šå…¨é‡åœ°æ¯¯å¼æŒ–æ˜æœº
=====================================================
è¿™æ˜¯æœ€å¼ºå¤§çš„ç‰ˆæœ¬ï¼ç›´æ¥åœ¨F12æ§åˆ¶å°è¿è¡Œï¼Œä¼šè‡ªåŠ¨ç‚¹å‡»æ‰€æœ‰å·¦ä¾§èœå•é¡¹ã€‚

ã€ä½¿ç”¨æ–¹æ³•ã€‘
1. åˆ·æ–°æ”¿é‡‡äº‘é¡µé¢
2. æŒ‰ F12 æ‰“å¼€æ§åˆ¶å°
3. å¤åˆ¶ä¸‹é¢æ•´æ®µä»£ç 
4. ç²˜è´´åˆ°Consoleå¹¶å›è½¦
5. æŠŠæ‰‹ç¦»å¼€é¼ æ ‡ï¼Œè®©è„šæœ¬è‡ªå·±è·‘2-3åˆ†é’Ÿ
6. çœ‹åˆ°"å¤§åŠŸå‘Šæˆ"å¼¹çª—ï¼Œè‡ªåŠ¨ä¸‹è½½JSONæ–‡ä»¶

ã€æ³¨æ„äº‹é¡¹ã€‘
- è¿è¡ŒæœŸé—´ç•Œé¢ä¼šè‡ªåŠ¨æ»šåŠ¨ï¼Œè¿™æ˜¯æ­£å¸¸çš„
- ä¸è¦ç‚¹å‡»ç½‘é¡µå…¶ä»–åœ°æ–¹ï¼Œé¿å…æ‰“æ–­è„šæœ¬
- å¦‚æœå¡ä½è¶…è¿‡10ç§’ï¼Œæ‰‹åŠ¨ç‚¹ä¸€ä¸‹ä¸‹ä¸€ä¸ªç±»ç›®å³å¯ç»§ç»­

=====================================================
å¤åˆ¶ä¸‹é¢è¿™æ®µä»£ç åˆ°æ§åˆ¶å°è¿è¡Œï¼š
=====================================================

// â˜¢ï¸ æ ¸æ­¦çº§è„šæœ¬ï¼šå…¨é‡åœ°æ¯¯å¼æŒ–æ˜æœº (è¦†ç›–ç‡ 100%+)
(async function() {
    console.clear();
    console.log("â˜¢ï¸ æ ¸æ­¦çº§æŒ–æ˜æœºå·²å¯åŠ¨ï¼å‡†å¤‡è¿›è¡Œå…¨é‡æ‰«æ...");
    
    // 1. å»ºç«‹å·¨å¤§çš„ä»“åº“
    window.MEGA_DATABASE = {}; 
    let totalCaptured = 0;

    // 2. éƒ¨ç½²æœ€é«˜çº§æ‹¦æˆªç½‘ (åŒæ—¶æ‹¦æˆª Fetch å’Œ XHR)
    const originalFetch = window.fetch;
    window.fetch = async function(...args) {
        const response = await originalFetch(...args);
        const clone = response.clone();
        clone.json().then(data => process(data, args[0])).catch(()=>{});
        return response;
    };

    const XHR = XMLHttpRequest.prototype;
    const send = XHR.send;
    const open = XHR.open;
    XHR.open = function(method, url) { this._url = url; return open.apply(this, arguments); };
    XHR.send = function() {
        this.addEventListener('load', function() {
            try { process(JSON.parse(this.responseText), this._url); } catch (e) {}
        });
        return send.apply(this, arguments);
    };

    // 3. æ•°æ®åŠ å·¥å‚
    function process(json, url) {
        // è¿‡æ»¤æ‰ç›‘æ§æ•°æ®å’Œæ— å…³æ¥å£
        if (!url || url.includes('batchPush') || url.includes('collect')) return;

        const list = json.result || json.data || json.list || json;
        if (Array.isArray(list)) {
            list.forEach(item => {
                // åªè¦æ˜¯æœ‰ ID å’Œ Name çš„ï¼Œç»Ÿç»ŸæŠ“èµ°
                if (item && item.id && item.name) {
                    if (!window.MEGA_DATABASE[item.id]) {
                        window.MEGA_DATABASE[item.id] = {
                            id: item.id,
                            name: item.name,
                            pid: item.parentId || 0,
                            code: item.code,
                            is_leaf: item.leafFlag
                        };
                        totalCaptured++;
                        // åªåœ¨æ§åˆ¶å°æ¯æŠ“ 10 ä¸ªæ˜¾ç¤ºä¸€æ¬¡ï¼Œé˜²æ­¢å¡æ­»
                        if (totalCaptured % 10 === 0) {
                            console.log(`ğŸ“¦ å·²æ•è·ç±»ç›®æ•°é‡: ${totalCaptured} ...`);
                        }
                    }
                }
            });
        }
    }

    // 4. æš´åŠ›ç‚¹å‡»é€»è¾‘
    const items = document.querySelectorAll('.doraemon-list-item'); // é”å®šå·¦ä¾§èœå•æ‰€æœ‰é¡¹
    if (items.length === 0) {
        alert("âŒ æ²¡æ‰¾åˆ°å·¦ä¾§èœå•ï¼è¯·ç¡®ä¿ä½ åœ¨ã€ç±»ç›®é€‰æ‹©ã€‘é¡µé¢ï¼");
        return;
    }

    console.log(`ğŸ¯ é”å®šç›®æ ‡ï¼šå…±å‘ç° ${items.length} ä¸ªä¸€çº§å¤§ç±»ã€‚å‡†å¤‡é€ä¸ªå‡»ç ´...`);
    alert(`å‡†å¤‡å¥½äº†å—ï¼Ÿ\n\næˆ‘è¦å¼€å§‹è‡ªåŠ¨ç‚¹å‡»è¿™ ${items.length} ä¸ªèœå•äº†ã€‚\n\nè¿‡ç¨‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼Œè¯·ä¸è¦åŠ¨é¼ æ ‡ï¼`);

    // éå†æ¯ä¸€ä¸ªèœå•é¡¹
    for (let i = 0; i < items.length; i++) {
        const item = items[i];
        const categoryName = item.innerText.split('\n')[0];
        
        console.log(`ğŸ‘† [${i+1}/${items.length}] æ­£åœ¨ç‚¹å‡»: ${categoryName}`);
        
        // æ¨¡æ‹ŸçœŸå®ç‚¹å‡»
        item.click();
        item.scrollIntoView({block: "center"}); // è‡ªåŠ¨æ»šåŠ¨ï¼Œå‡è£…æ˜¯äººåœ¨çœ‹

        // â³ åŠ¨æ€ç­‰å¾… (é‡è¦ï¼é˜²æ­¢è¢«å° IP)
        // éšæœºç­‰å¾… 1.5 åˆ° 2.5 ç§’
        const waitTime = 1500 + Math.random() * 1000;
        await new Promise(r => setTimeout(r, waitTime));
    }

    // 5. å®Œå·¥å¯¼å‡º
    console.clear();
    console.log(`âœ…âœ…âœ… æ‰«è¡å®Œæˆï¼å…±æ•è· ${totalCaptured} ä¸ªç±»ç›®ï¼`);
    
    // ç”Ÿæˆä¸‹è½½
    const dataStr = JSON.stringify(Object.values(window.MEGA_DATABASE), null, 2);
    const blob = new Blob([dataStr], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "ZCY_FULL_COVERAGE_DB.json";
    a.click();
    
    console.log("ğŸ’¾ æ–‡ä»¶å·²è‡ªåŠ¨ä¸‹è½½ï¼šZCY_FULL_COVERAGE_DB.json");
    alert("å¤§åŠŸå‘Šæˆï¼\n\næ‰€æœ‰èƒ½ç‚¹å¼€çš„ç±»ç›®éƒ½å·²ç»æŠ“ä¸‹æ¥äº†ã€‚\næ–‡ä»¶å·²è‡ªåŠ¨ä¸‹è½½ï¼Œè¯·æŸ¥æ”¶ï¼");

})();

=====================================================
ğŸ¯ ä¸‰ç§æ–¹æ¡ˆé€‰æ‹©æŒ‡å—
=====================================================

æ–¹æ¡ˆ1: Chromeæ‰©å±•ï¼ˆé€‚åˆé•¿æœŸä½¿ç”¨ï¼‰
- å®‰è£…ä¸€æ¬¡ï¼Œæ°¸ä¹…å¯ç”¨
- éœ€è¦åˆ›å»º3ä¸ªæ–‡ä»¶ï¼ˆmanifest.json, inject.js, content.jsï¼‰
- å³ä¸‹è§’æ˜¾ç¤ºç»¿è‰²é¢æ¿ï¼Œæ“ä½œç›´è§‚
- æ¨èï¼šç»å¸¸éœ€è¦æ›´æ–°ç±»ç›®æ•°æ®çš„ç”¨æˆ·

æ–¹æ¡ˆ2: æŸ¥æ¼è¡¥ç¼ºè„šæœ¬ï¼ˆé€‚åˆè¡¥å……ç‰¹å®šç±»ç›®ï¼‰
- é’ˆå¯¹æ€§è·å–ç¼ºå¤±çš„ç±»ç›®ï¼ˆæœºç”µã€å›¾ä¹¦ç­‰18ä¸ªå…³é”®è¯ï¼‰
- ç›´æ¥åœ¨æ§åˆ¶å°è¿è¡Œ
- è½»é‡å¿«é€Ÿ
- æ¨èï¼šå·²æœ‰å¤§éƒ¨åˆ†æ•°æ®ï¼Œåªéœ€è¡¥å……çš„ç”¨æˆ·

æ–¹æ¡ˆ3: ç»ˆæåœ°æ¯¯å¼æŒ–æ˜æœº â˜¢ï¸ï¼ˆé€‚åˆä¸€æ¬¡æ€§å…¨é‡è·å–ï¼‰â­ æœ€å¼º
- è‡ªåŠ¨ç‚¹å‡»æ‰€æœ‰å·¦ä¾§èœå•
- 100%è¦†ç›–æ‰€æœ‰å¯è§ç±»ç›®
- ä¸€æ¬¡è¿è¡Œå³å¯è·å¾—å®Œæ•´æ•°æ®
- æ¨èï¼šç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œæƒ³è·å–æ‰€æœ‰æ•°æ®çš„ç”¨æˆ·

=====================================================
ç»“æŸ - æ‰€æœ‰ä»£ç å·²åŒ…å«
ä¸‰ç§æ–¹æ¡ˆä»»é€‰ï¼Œç»ˆæç‰ˆæœ€çœäº‹ï¼
=====================================================
