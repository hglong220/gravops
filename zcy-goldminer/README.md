# 🔨 ZCY-GoldMiner - 政采云核心类目挖掘机

## 📖 功能描述

这是一个专门用于政采云（ZCY）类目数据提取的 Chrome 扩展。它会在页面右下角注入一个控制面板，提供"一键挖掘核心类目"功能。

### 主要功能：
- ✅ 自动调用政采云后端 API 获取类目数据
- ✅ 利用用户当前登录凭证（Cookie）进行认证
- ✅ 递归获取完整的类目树状结构
- ✅ 支持以下核心类目：
  - 计算机设备及软件
  - 3C数码
  - 办公设备/耗材
  - 文化用品
  - 家用电器
  - 家具用具
- ✅ 自动导出为 JSON 文件

## 🔧 安装步骤

### 1. 准备文件
所有文件已经在 `g:\gravops\zcy-goldminer` 文件夹中：
- `manifest.json` - 扩展配置文件
- `content.js` - 核心挖掘逻辑

### 2. 加载到 Chrome

1. 打开 Chrome 浏览器
2. 在地址栏输入: `chrome://extensions/`
3. 在右上角启用 **"开发者模式"**
4. 点击左上角的 **"加载已解压的扩展程序"**
5. 选择文件夹: `g:\gravops\zcy-goldminer`
6. 确认安装成功（会显示"政采云核心类目挖掘机"）

## 📝 使用说明

### 步骤 1：打开政采云页面
1. 访问政采云网站: https://www.zcygov.cn/
2. 确保你已经登录（这样扩展才能使用你的 Cookie）
3. 进入 **商品发布 / 类目选择** 页面

### 步骤 2：启动挖掘
1. 等待 2 秒，页面右下角会出现 **"⛏️ 类目挖掘机"** 面板
2. （可选）点击 **"1. 扫描左侧菜单获取最新ID"** - 这会尝试从页面菜单更新类目ID
3. 点击 **"2. 开始挖掘核心数据"** - 开始自动提取数据

### 步骤 3：等待完成
- 挖掘过程中会在面板上显示实时日志
- 每个大类之间会间隔 1 秒，防止触发限流
- 完成后会自动下载 `zcy_core_categories.json` 文件

## 📊 输出格式

导出的 JSON 文件结构如下：

```json
[
  {
    "id": 3564,
    "name": "计算机设备及软件",
    "children": [
      {
        "id": 12345,
        "name": "台式机",
        "code": "DESKTOP",
        "is_leaf": false,
        "children": [
          {
            "id": 67890,
            "name": "品牌台式机",
            "code": "BRAND_DESKTOP",
            "is_leaf": true
          }
        ]
      }
    ]
  }
]
```

## ⚙️ 技术细节

### API 端点
使用的主要 API：
```
/api/micro/category/backCategories/categoriesByLayer/cacheUpdate/common
```

### 参数说明
- `timestamp`: 当前时间戳
- `pid`: 父类目 ID
- `scene`: 场景值（0 表示通用）
- `needQualificationMark`: 是否需要资质标记

### 递归深度
默认挖掘 **3 层**（爷爷 -> 父亲 -> 孙子），可以通过修改 `content.js` 调整深度。

### 防止限流
- 每个大类之间间隔 1 秒
- 子类目之间间隔 0.5 秒

## 🔍 故障排除

### 问题 1：面板没有出现
- **原因**: 页面可能还没加载完成
- **解决**: 刷新页面，或者检查是否在政采云域名下（*.zcygov.cn）

### 问题 2：扫描菜单失败
- **原因**: 页面结构可能不同
- **解决**: 直接点击"开始挖掘"，使用默认的硬编码 ID

### 问题 3：挖掘失败或数据为空
- **原因**: 
  - 没有登录或登录过期
  - 类目 ID 不正确
  - API 接口变更
- **解决**: 
  - 重新登录政采云
  - 使用浏览器开发者工具（F12）查看 Network 面板，检查 API 响应

### 问题 4：只挖掘到部分数据
- **原因**: 某些类目 ID 可能不存在或无权限访问
- **解决**: 检查日志面板中的错误信息，手动修正 `content.js` 中的 `SEED_IDS`

## 🛠️ 自定义配置

### 修改种子类目
编辑 `content.js` 中的 `SEED_IDS` 数组：

```javascript
const SEED_IDS = [
    { name: "你的类目名称", id: 你的类目ID },
    // 添加更多...
];
```

### 调整挖掘深度
在 `fetchCategoryTree` 函数中，可以修改递归逻辑以挖掘更多层级。

### 调整请求间隔
修改以下延迟时间（单位：毫秒）：
```javascript
await new Promise(r => setTimeout(r, 1000)); // 大类之间间隔
await new Promise(r => setTimeout(r, 500));  // 子类之间间隔
```

## 📌 注意事项

1. **登录状态**: 确保始终保持登录状态
2. **数据准确性**: 首次使用建议先用"扫描菜单"功能验证 ID
3. **合理使用**: 避免频繁请求，防止被封禁IP
4. **数据验证**: 导出后请检查 JSON 文件的完整性

## 📄 文件说明

- `manifest.json`: Chrome 扩展的配置文件，定义权限和加载规则
- `content.js`: 核心业务逻辑，包含 UI 注入、API 调用、数据处理
- `README.md`: 本说明文档

## 🔗 相关资源

- [Chrome 扩展开发文档](https://developer.chrome.com/docs/extensions/)
- [政采云官网](https://www.zcygov.cn/)

## 🙋 问题反馈

如有问题请检查：
1. 浏览器控制台（F12 > Console）的错误信息
2. 面板中的日志输出
3. Network 面板中的 API 请求响应

---

**版本**: 1.0  
**最后更新**: 2025-11-29
